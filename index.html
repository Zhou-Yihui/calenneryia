<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>大凉国明华国历</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <style>
    body { margin:0; font-family: system-ui; background:#1a1a1a; color:#d4f1d4; overflow-x: hidden; }
    header { background:#d4f1d4; color:#1a1a1a; padding:1rem; text-align:center; font-size:1.2rem; }
    .today-bar { background:#222; padding:0.5rem 1rem; text-align:center; font-size:1rem; position:sticky; top:0; z-index:10; }
    .year-container { display:flex; overflow-x:auto; scroll-behavior:smooth; padding:0.5rem; }
    .year { flex:0 0 auto; margin-right:1rem; background:#333; border-radius:6px; padding:0.5rem; min-width:250px; }
    .month { margin-top:0.5rem; background:#444; border-radius:4px; padding:0.3rem; text-align:center; font-weight:bold; }
    .calendar-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:2px; margin-top:0.2rem; }
    .day { padding:0.3rem; text-align:center; border-radius:4px; background:#222; font-size:0.8rem; }
    .day.today { background:#d4f1d4; color:#1a1a1a; font-weight:bold; }
    .footer { padding:0.5rem; text-align:center; font-size:0.7rem; opacity:0.6; }
    .weekday { font-size:0.7rem; opacity:0.7; }
  </style>
</head>
<body>
  <header>明华历 - 大凉国 PWA 日历</header>
  <div class="today-bar" id="todayBar">加载中...</div>
  <div class="year-container" id="calendar"></div>
  <div class="footer">前端 PWA · 国历为主体 · 公历仅提示</div>

  <script>
    // ======= 核心参数 =======
    const START_YEAR = 1; // 元年
    const MONTHS = 28; // 每年28月
    const DAYS_PER_MONTH = 120; // 示例平均120天，侯10天
    const HOU_NAMES = ["一侯","二侯","三侯","四侯","五侯","六侯","七侯","末侯"];
    const STAR_SIGNS = ["晨曦星","幽冥星","流光星","玄辰星","碧落星","曜灵星","霁月星"];
    const DIRECTIONS = ["东","南","西","北","中","上","下","东南","东北","西南","西北","上北","上南","上东","上西","下北","下南","下东","下西"];

    // 动态时间
    let now = new Date();

    function pad(n){return n<10?"0"+n:n;}

    // 模拟国历计算：根据实际时间计算国历
    function getMHDate(now){
      // 简化公式：假设每国历日 = 1.42地球日（示例）
      const base = new Date(-30000,0,1); // 元年对应公元前三万年
      const diffMs = now - base;
      const diffDays = diffMs / (1000*60*60*24) * 1.42; 
      const y = Math.floor(diffDays / (DAYS_PER_MONTH*MONTHS)) + 1;
      const m = Math.floor((diffDays % (DAYS_PER_MONTH*MONTHS)) / DAYS_PER_MONTH) + 1;
      const d = Math.floor(diffDays % DAYS_PER_MONTH) + 1;
      const h = now.getHours();
      const min = now.getMinutes();
      const s = now.getSeconds();
      // 侯
      const hou = HOU_NAMES[Math.min(Math.floor((d-1)/10), HOU_NAMES.length-1)];
      // 星象
      const star = STAR_SIGNS[d % STAR_SIGNS.length];
      // 方位
      const dir = DIRECTIONS[d % DIRECTIONS.length];
      return {y,m,d,h,min,s,hou,star,dir};
    }

    function renderCalendar(){
      const cal = document.getElementById("calendar");
      cal.innerHTML = "";
      // 只渲染前后两年示例，可滚动查看更多
      const mh = getMHDate(new Date());
      for(let y=mh.y-1; y<=mh.y+1; y++){
        const yearDiv = document.createElement("div");
        yearDiv.className = "year";
        const yearTitle = document.createElement("div");
        yearTitle.textContent = `国历 ${y} 年`;
        yearDiv.appendChild(yearTitle);

        for(let m=1;m<=MONTHS;m++){
          const monthDiv = document.createElement("div");
          monthDiv.className="month";
          monthDiv.textContent = `${m} 月`;
          yearDiv.appendChild(monthDiv);

          const grid = document.createElement("div");
          grid.className="calendar-grid";
          for(let d=1;d<=DAYS_PER_MONTH;d++){
            const cell = document.createElement("div");
            cell.className="day";

            // 判断今天
            if(y===mh.y && m===mh.m && d===mh.d) cell.classList.add("today");

            const hou = HOU_NAMES[Math.min(Math.floor((d-1)/10), HOU_NAMES.length-1)];
            const star = STAR_SIGNS[d % STAR_SIGNS.length];
            const dir = DIRECTIONS[d % DIRECTIONS.length];

            const baseDate = new Date(-30000,0,1);
            const gDate = new Date(baseDate.getTime() + ((y-1)*MONTHS*DAYS_PER_MONTH + (m-1)*DAYS_PER_MONTH + (d-1)) / 1.42 * 86400000);

            cell.innerHTML = `<div>${d}日 (${hou})</div><div class="weekday">${star}·${dir}</div><div class="weekday">公历:${gDate.getFullYear()}-${pad(gDate.getMonth()+1)}-${pad(gDate.getDate())}</div>`;
            grid.appendChild(cell);
          }
          yearDiv.appendChild(grid);
        }
        cal.appendChild(yearDiv);
      }
    }

    function updateTodayBar(){
      const mh = getMHDate(new Date());
      document.getElementById("todayBar").textContent =
        `今天：国历 ${mh.y} 年 ${mh.m} 月 ${mh.d} 日 (${mh.h}:${pad(mh.min)}:${pad(mh.s)})　${mh.hou}　星象:${mh.star}　方位:${mh.dir}　公历提示:${new Date().toISOString().slice(0,10)}`;
    }

    function tick(){
      renderCalendar();
      updateTodayBar();
    }

    setInterval(tick,1000); // 每秒刷新
    tick();
  </script>
</body>
</html>
